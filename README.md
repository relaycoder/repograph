<div align="center">

<img src="https://raw.githubusercontent.com/relaycoder/repograph/main/assets/logo.svg" alt="RepoGraph Logo" width="150"/>

# RepoGraph

### Your Codebase, Visualized & Understood.

**Generate rich, semantic, and interactive codemaps to navigate, analyze, and master any repository, in any environment.**

[![NPM Version](https://img.shields.io/npm/v/repograph?style=for-the-badge&color=CB3837)](https://www.npmjs.com/package/repograph)
[![License](https://img.shields.io/npm/l/repograph?style=for-the-badge&color=blue)](./LICENSE)
[![Build Status](https://img.shields.io/github/actions/workflow/status/relaycoder/repograph/ci.yml?branch=main&style=for-the-badge)](https://github.com/relaycoder/repograph/actions)
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=for-the-badge)](http://makeapullrequest.com)

</div>

---

Ever felt lost in a new codebase? Struggled to see the big picture or find the most critical files? RepoGraph is your solution. It's a powerful **isomorphic** tool and library that analyzes your code, builds a dependency graph, ranks key files and symbols, and generates a beautiful, detailed Markdown report.

Whether you're onboarding new engineers, planning a large-scale refactor, or even providing context to an AI, RepoGraph gives you the map you need to navigate with confidence‚Äî**both in your terminal and in the browser**.

## ‚ú® Key Features & Benefits

| Feature                               | Benefit                                                                                                                                                    |
| :------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **üß† Multi-Language Semantic Analysis** | Uses **Tree-sitter** to parse your code with deep understanding, identifying not just files, but classes, functions, methods, and their relationships.     |
| **‚ö° Parallel Processing**              | Leverages **worker threads** to analyze files in parallel, dramatically speeding up analysis for large codebases with configurable worker pools.        |
| **‚≠ê Intelligent Ranking Algorithms**   | Go beyond file names. Rank code by importance using **PageRank** (centrality) or **Git Hot-Spots** (change frequency) to immediately find what matters.       |
| **üéØ Rich Symbol Qualifiers**           | Extract deep metadata including visibility (`public`/`private`), `async`/`static` status, purity, exception handling, parameter types, and return types. |
| **üåê Browser & Node.js Support**       | Run analysis anywhere. Use the powerful CLI in your terminal or integrate the library directly into your web-based IDE or analysis tools.                 |
| **üé® Comprehensive Markdown Reports**  | Generates a `repograph.md` file with a project overview, dependency graphs, ranked file lists, and detailed symbol breakdowns.                              |
| **üß© Composable Pipeline API**         | A fully functional, composable API allows you to replace or extend any part of the pipeline: **Discover ‚Üí Analyze ‚Üí Rank ‚Üí Render**.                         |
| **‚öôÔ∏è Highly Configurable CLI**          | Fine-tune your analysis and output with a rich set of command-line flags to include/ignore files, customize the report, and more.                            |

## üöÄ Why Use RepoGraph?

-   **Accelerate Onboarding:** Give new developers a guided tour of the codebase, highlighting the most important entry points and modules.
-   **Master Code Navigation:** Understand how components are interconnected, making it easier to trace logic and predict the impact of changes.
-   **Prioritize Refactoring:** Identify highly-central but frequently changed files‚Äîprime candidates for refactoring and stabilization.
-   **Enhance AI Context:** Feed a structured, ranked, and semantically-rich overview of your codebase to LLMs for vastly improved code generation, analysis, and Q&A.
-   **Build In-Browser Tools:** Integrate RepoGraph into your web applications to create live code explorers, visualizers, or educational platforms without a server-side component.
-   **Streamline Architectural Reviews:** Get a high-level, data-driven view of your system's architecture to facilitate design discussions.

## üì∏ Gallery: Example Output

Imagine running `repograph` on a small project. Here's a glimpse of the beautiful and insightful Markdown file it produces.

---

# RepoGraph

_Generated by RepoGraph on 2025-07-20T06:21:00.000Z_

## üöÄ Project Overview

This repository contains 25 nodes (5 files).

### Module Dependency Graph

```mermaid
graph TD
    src/index.ts["index.ts"] --> src/composer.ts["composer.ts"]
    src/index.ts["index.ts"] --> src/high-level.ts["high-level.ts"]
    src/high-level.ts["high-level.ts"] --> src/composer.ts["composer.ts"]
    src/composer.ts["composer.ts"] --> src/pipeline/discover.ts["discover.ts"]
    src/composer.ts["composer.ts"] --> src/pipeline/analyze.ts["analyze.ts"]
    src/composer.ts["composer.ts"] --> src/pipeline/rank.ts["rank.ts"]
    src/composer.ts["composer.ts"] --> src/pipeline/render.ts["render.ts"]
```

### Top 5 Most Important Files

| Rank | File                      | Description                       |
| :--- | :------------------------ | :-------------------------------- |
| 1    | `src/pipeline/analyze.ts` | Key module in the architecture.   |
| 2    | `src/index.ts`            | Key module in the architecture.   |
| 3    | `src/composer.ts`         | Key module in the architecture.   |
| 4    | `src/types.ts`            | Key module in the architecture.   |
| 5    | `src/pipeline/render.ts`  | Key module in the architecture.   |

---

## üìÇ File & Symbol Breakdown

### [`src/pipeline/analyze.ts`](./src/pipeline/analyze.ts)

-   **`function createTreeSitterAnalyzer`** - _L257_
    ```typescript
    export const createTreeSitterAnalyzer = (): Analyzer => {
    ```
-   **`function processFileDefinitions`** (throws) - _L291_
    ```typescript
    function processFileDefinitions(
    ```
-   **`function findEnclosingSymbolId`** (calls `parent`) - _L461_
    ```typescript
    function findEnclosingSymbolId(startNode: TSNode, file: FileContent, nodes: ReadonlyMap<string, CodeNode>): string | null {
    ```

---

## üî¨ Rich Semantic Analysis

RepoGraph extracts deep semantic details from your code, making it perfect for integration with advanced analysis and AI tools.

### Symbol Qualifiers Extracted

-   **Visibility:** `public`, `private`, `protected`, `internal`, `default`
-   **Modifiers:** `async`, `static`
-   **Behavior:** `canThrow` (detects exceptions), `isPure` (detects side-effect-free functions)
-   **Type System:** Parameter names and types, return types

### Example: TypeScript Analysis

Given this code:

```typescript
export class UserService {
  public async getUser(id: string): Promise<User> {
    if (!id) throw new Error('ID is required');
    return await this.repository.findById(id);
  }

  private static validateEmail(email: string): boolean {
    return email.includes('@');
  }
}
```

RepoGraph produces a `CodeNode` with this structured metadata:

-   `getUser`: `visibility: 'public'`, `isAsync: true`, `canThrow: true`, `returnType: 'Promise<User>'`, `parameters: [{ name: 'id', type: 'string' }]`
-   `validateEmail`: `visibility: 'private'`, `isStatic: true`, `returnType: 'boolean'`, `parameters: [{ name: 'email', type: 'string' }]`

This rich metadata enables sophisticated integrations with tools like **`scn-ts`** for enhanced code visualization and AI-powered analysis.

## üì¶ Installation

```bash
# Using npm
npm install repograph

# Using yarn
yarn add repograph

# Using pnpm
pnpm add repograph
```
To use the CLI globally, install with a `-g` flag.

## üõ†Ô∏è Usage

### Command-Line Interface (CLI)

The CLI is the quickest way to get a codemap. Simply navigate to your project's root directory and run the command.

**Basic Usage**

```bash
# Analyze the current directory and create repograph.md
repograph
```

**Advanced Usage**

```bash
# Analyze a specific project, use the git-changes ranker, and customize the output
repograph ./my-cool-project \
  --output docs/CodeMap.md \
  --ranking-strategy git-changes \
  --ignore "**/__tests__/**" \
  --max-workers 4 \
  --no-mermaid
```

#### All CLI Options

| Command / Argument              | Alias | Description                                                                   | Default                     |
| :------------------------------ | :---- | :---------------------------------------------------------------------------- | :-------------------------- |
| **Commands**                    |       |                                                                               |                             |
| `[root]`                        |       | Analyze a repository at the given root path. This is the default command.     | `.`                         |
| `copy-wasm [destination]`       |       | Copy Tree-sitter WASM files to a directory for browser usage.                   | `./public/wasm`             |
| **Arguments & Options**         |       |                                                                               |                             |
| `--output <path>`               |       | Path to the output Markdown file.                                             | `repograph.md`              |
| `--include <pattern>`           |       | Glob pattern for files to include. Can be specified multiple times.             | `**/*`                      |
| `--ignore <pattern>`            |       | Glob pattern for files to ignore. Can be specified multiple times.              |                             |
| `--no-gitignore`                |       | Do not respect `.gitignore` files.                                              | `false`                     |
| `--ranking-strategy <name>`     |       | Ranking strategy: `pagerank` or `git-changes`.                                  | `pagerank`                  |
| `--max-workers <num>`           |       | Number of parallel workers for analysis. Set to 1 for single-threaded.          | `1`                         |
| `--log-level <level>`           |       | Logging level: `silent`, `error`, `warn`, `info`, `debug`.                      | `info`                      |
| `--help`                        | `-h`  | Display the help message.                                                     |                             |
| `--version`                     | `-v`  | Display the version number.                                                     |                             |
| **Output Formatting**           |       |                                                                               |                             |
| `--no-header`                   |       | Do not include the main "RepoGraph" header.                                     | `false`                     |
| `--no-overview`                 |       | Do not include the project overview section.                                    | `false`                     |
| `--no-mermaid`                  |       | Do not include the Mermaid dependency graph.                                    | `false`                     |
| `--no-file-list`                |       | Do not include the list of top-ranked files.                                    | `false`                     |
| `--no-symbol-details`           |       | Do not include the detailed file and symbol breakdown.                          | `false`                     |
| `--top-file-count <num>`        |       | Number of files in the top list.                                                | `10`                        |
| `--file-section-separator <str>`|       | Custom separator for file sections.                                             | `---`                       |
| `--no-symbol-relations`         |       | Hide symbol relationship details (e.g., `calls`).                               | `false`                     |
| `--no-symbol-line-numbers`      |       | Hide line numbers for symbols.                                                  | `false`                     |
| `--no-symbol-snippets`          |       | Hide code snippets for symbols.                                                 | `false`                     |
| `--max-relations-to-show <num>` |       | Max number of 'calls' relations to show per symbol.                             | `3`                         |

### üìö Programmatic API

For ultimate flexibility, use the RepoGraph programmatic API. Integrate it into your own tools, build custom pipelines, and invent new ways to analyze code.

#### High-Level API (`analyzeProject`)

This is the main entry point for both Node.js and browser environments.

**Node.js Usage (File Discovery)**

```typescript
// my-node-script.ts
import { analyzeProject, createMarkdownRenderer } from 'repograph';
import path from 'node:path';
import fs from 'node:fs/promises';

// Analyze files on disk
const rankedGraph = await analyzeProject({
  root: path.resolve('./path/to/your/project'),
  rankingStrategy: 'git-changes',
  maxWorkers: 4,
});

// Render the output
const renderer = createMarkdownRenderer();
const markdown = renderer(rankedGraph);

await fs.writeFile('report.md', markdown);
console.log('‚úÖ Report generated!');
```

**Browser Usage (In-Memory Files)**

To use RepoGraph in the browser, you must provide the file content directly.

1.  **Copy WASM files:** First, copy the necessary parser files into your public web directory.

    ```bash
    npx repograph copy-wasm ./public/wasm
    ```

2.  **Initialize and Analyze:** In your application code, initialize the parser with the location of the WASM files and then pass your in-memory file data to `analyzeProject`.

    ```typescript
    // my-browser-app.ts
    import { initializeParser, analyzeProject, createMarkdownRenderer } from 'repograph';

    // In-memory file data (e.g., from a file upload, API, or Monaco editor)
    const files = [
      { path: 'src/index.ts', content: 'import { a } from "./utils";' },
      { path: 'src/utils.ts', content: 'export const a = 1;' },
    ];

    async function runAnalysis() {
      // 1. Initialize parser with the path to your WASM files
      await initializeParser({ wasmBaseUrl: '/wasm/' });

      // 2. Analyze the in-memory files
      const rankedGraph = await analyzeProject({
        files: files, // This skips file-system discovery
        rankingStrategy: 'pagerank', // 'git-changes' is not available in browser
      });

      // 3. Render the output to a string
      const renderer = createMarkdownRenderer();
      const markdown = renderer(rankedGraph, { includeMermaidGraph: true });

      // 4. Display the markdown in your app
      document.getElementById('report-container').innerText = markdown;
    }

    runAnalysis();
    ```

## üß© The RepoGraph Pipeline

RepoGraph processes your code in four distinct, composable stages:

1.  **`üîç Discover`**
    -   Scans the filesystem using glob patterns, respecting `.gitignore`.
    -   Reads all matching files into memory. (Skipped when `files` are provided).

2.  **`üß† Analyze`**
    -   Parses files using **Tree-sitter** and language-specific queries.
    -   Extracts symbol definitions (classes, functions), relationships (imports, calls), UI structure (JSX tags), and rich semantic qualifiers (`async`, `canThrow`, etc.).
    -   Builds the core `CodeGraph` of nodes and edges.

3.  **`‚≠ê Rank`**
    -   Applies a ranking algorithm (like PageRank) to assign a score to every node in the graph.
    -   Produces a `RankedCodeGraph`.

4.  **`üé® Render`**
    -   Receives the `RankedCodeGraph` and options.
    -   Generates the final Markdown output, including the summary, Mermaid graph, and detailed breakdowns.

## üìã API Types Reference

The core `CodeNode` type is enriched with detailed semantic qualifiers.

```typescript
export type CodeNodeVisibility = 'public' | 'private' | 'protected' | 'internal' | 'default';

export type CodeNode = {
  readonly id: string;           // Unique identifier (e.g., 'src/api.ts#MyClass')
  readonly type: CodeNodeType;   // Symbol type (class, function, etc.)
  readonly name: string;         // Symbol name
  readonly filePath: string;     // File location
  readonly startLine: number;
  readonly endLine: number;
  readonly language?: string;
  readonly codeSnippet?: string; // Code preview (e.g., function signature)

  // Rich Semantic Qualifiers
  readonly visibility?: CodeNodeVisibility;
  readonly isAsync?: boolean;
  readonly isStatic?: boolean;
  readonly canThrow?: boolean; // True if the function contains a 'throw' statement
  readonly isPure?: boolean;   // True if the function appears to have no side-effects

  // Type & Parameter Information
  readonly returnType?: string;
  readonly parameters?: Array<{
    name: string;
    type?: string;
  }>;
};
```

## ‚ö° Performance Optimization

RepoGraph includes powerful parallel processing capabilities to dramatically speed up analysis of large codebases.

### Worker Threads

By default, RepoGraph analyzes files sequentially (`maxWorkers: 1`). For large projects, you can enable parallel processing using worker threads:

```bash
# CLI: Use 4 parallel workers
repograph --max-workers 4

# For CPU-intensive projects, use more workers (typically CPU cores)
repograph --max-workers 8
```

```typescript
// API: Configure parallel processing
import { analyzeProject } from 'repograph';

const graph = await analyzeProject({
  root: './large-codebase',
  maxWorkers: 4, // Parallel file processing
});
```

### Performance Guidelines

- **Small projects (< 100 files)**: Use `maxWorkers: 1` to avoid worker overhead
- **Medium projects (100-1000 files)**: Use `maxWorkers: 2-4` for optimal performance
- **Large projects (> 1000 files)**: Use `maxWorkers: 4-8` or match your CPU core count
- **CI/CD environments**: Consider available CPU resources and memory limits

### Implementation Details

RepoGraph uses the [`tinypool`](https://github.com/tinylibs/tinypool) library to manage worker threads efficiently. Each worker:

- Parses files using Tree-sitter in isolation
- Extracts code nodes and relationships
- Returns serializable data to the main thread
- Automatically handles worker lifecycle and error recovery

The main thread coordinates workers and resolves cross-file relationships after all files are processed.

## üåê Supported Languages

Thanks to Tree-sitter, RepoGraph has robust support for a wide array of popular languages:

-   **JavaScript / TypeScript:** First-class support, including `JSX` and `TSX`.
-   **Web & UI:** `Vue`, with structural analysis for `HTML` and styling intent for `CSS`.
-   **Backend:** `Python`, `Java`, `Go`, `Rust`, `C#`, `PHP`, `Ruby`.
-   **Systems:** `C`, `C++`.
-   **Web3:** `Solidity`.
-   ...and more, with support easily extended via new Tree-sitter queries.

## üôå Contributing

Contributions are welcome! Whether you're fixing a bug, adding a feature, or improving documentation, your help is appreciated.

1.  Fork the repository (`https://github.com/relaycoder/repograph`).
2.  Create your feature branch (`git checkout -b feature/AmazingFeature`).
3.  Make your changes.
4.  Commit your changes (`git commit -m 'Add some AmazingFeature'`).
5.  Push to the branch (`git push origin feature/AmazingFeature`).
6.  Open a Pull Request.

This project uses `bun` for development, `eslint` for linting, and `prettier` for formatting. Please ensure your contributions adhere to the existing code style.

## üìú License

This project is licensed under the **MIT License**. See the [LICENSE](./LICENSE) file for details.
