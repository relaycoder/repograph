realme-book@realme-book:~/Project/code/repograph$ bun test
bun test v1.2.17 (282dda62)

test/test-utilities.test.ts:
âœ“ Test Utilities > File System Utilities > should create and cleanup temporary directories
âœ“ Test Utilities > File System Utilities > should create test files [3.00ms]
âœ“ Test Utilities > File System Utilities > should create gitignore files [1.00ms]
58 |     it('should validate markdown content', () => {
59 |       const validMarkdown = '# Title\n\nThis is valid markdown.';
60 |       const invalidMarkdown = 'Just plain text without headers';
61 |
62 |       expect(isValidMarkdown(validMarkdown)).toBe(true);
63 |       expect(isValidMarkdown(invalidMarkdown)).toBe(false);
                                                    ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/realme-book/Project/code/repograph/test/test-utilities.test.ts:63:48)
âœ— Test Utilities > Validation Utilities > should validate markdown content [1.00ms]



test/unit/render.test.ts:

âœ“ Markdown Rendering > createMarkdownRenderer() > Renderer Customization Options > should use custom file section separator [1.00ms]
243 |       });
244 |
245 |       it('should not include relations when symbolDetailOptions.includeRelations is false', () => {
246 |         const markdown = renderer(rankedGraph, { symbolDetailOptions: { includeRelations: false } });
247 |         expect(markdown).not.toContain('(calls');
248 |         expect(markdown).toContain('**`function main`** - _L2_');
                               ^
error: expect(received).toContain(expected)

Expected to contain: "**`function main`** - _L2_"
Received: "# RepoGraph\n\n_Generated by RepoGraph on 2025-06-30T05:24:21.801Z_\n\n## ðŸš€ Project Overview\n\nThis repository contains 6 nodes (2 files).\n\n### Module Dependency Graph\n\n```mermaid\ngraph TD\n    src/main.ts[\"main.ts\"] --> src/utils.ts[\"utils.ts\"]\n```\n### Top 10 Most Important Files\n\n| Rank | File | Description |\n| :--- | :--- | :--- |\n| 1 | `src/main.ts` | Key module in the architecture. |\n| 2 | `src/utils.ts` | Key module in the architecture. |\n\n---\n\n## ðŸ“‚ File & Symbol Breakdown\n\n### [`src/main.ts`](./src/main.ts)\n\n_No symbols identified in this file._\n\n---\n\n### [`src/utils.ts`](./src/utils.ts)\n\n_No symbols identified in this file._\n\n---\n\n"

      at <anonymous> (/home/realme-book/Project/code/repograph/test/unit/render.test.ts:248:26)
âœ— Markdown Rendering > createMarkdownRenderer() > Renderer Customization Options > should not include relations when symbolDetailOptions.includeRelations is false
249 |       });
250 |
251 |       it('should not include line numbers when symbolDetailOptions.includeLineNumber is false', () => {
252 |         const markdown = renderer(rankedGraph, { symbolDetailOptions: { includeLineNumber: false } });
253 |         expect(markdown).not.toContain('- _L2_');
254 |         expect(markdown).toContain('**`function main`** (calls `helper`, `another`, `onemore`)');
                               ^
error: expect(received).toContain(expected)

Expected to contain: "**`function main`** (calls `helper`, `another`, `onemore`)"
Received: "# RepoGraph\n\n_Generated by RepoGraph on 2025-06-30T05:24:21.802Z_\n\n## ðŸš€ Project Overview\n\nThis repository contains 6 nodes (2 files).\n\n### Module Dependency Graph\n\n```mermaid\ngraph TD\n    src/main.ts[\"main.ts\"] --> src/utils.ts[\"utils.ts\"]\n```\n### Top 10 Most Important Files\n\n| Rank | File | Description |\n| :--- | :--- | :--- |\n| 1 | `src/main.ts` | Key module in the architecture. |\n| 2 | `src/utils.ts` | Key module in the architecture. |\n\n---\n\n## ðŸ“‚ File & Symbol Breakdown\n\n### [`src/main.ts`](./src/main.ts)\n\n_No symbols identified in this file._\n\n---\n\n### [`src/utils.ts`](./src/utils.ts)\n\n_No symbols identified in this file._\n\n---\n\n"

      at <anonymous> (/home/realme-book/Project/code/repograph/test/unit/render.test.ts:254:26)
âœ— Markdown Rendering > createMarkdownRenderer() > Renderer Customization Options > should not include line numbers when symbolDetailOptions.includeLineNumber is false [1.00ms]
259 |           symbolDetailOptions: { includeCodeSnippet: false },
260 |           includeMermaidGraph: false,
261 |         });
262 |         expect(markdown).not.toContain('```');
263 |         expect(markdown).not.toContain('function main() {}');
264 |         expect(markdown).toContain('**`function main`**');
                               ^
error: expect(received).toContain(expected)

Expected to contain: "**`function main`**"
Received: "# RepoGraph\n\n_Generated by RepoGraph on 2025-06-30T05:24:21.802Z_\n\n## ðŸš€ Project Overview\n\nThis repository contains 6 nodes (2 files).\n\n### Top 10 Most Important Files\n\n| Rank | File | Description |\n| :--- | :--- | :--- |\n| 1 | `src/main.ts` | Key module in the architecture. |\n| 2 | `src/utils.ts` | Key module in the architecture. |\n\n---\n\n## ðŸ“‚ File & Symbol Breakdown\n\n### [`src/main.ts`](./src/main.ts)\n\n_No symbols identified in this file._\n\n---\n\n### [`src/utils.ts`](./src/utils.ts)\n\n_No symbols identified in this file._\n\n---\n\n"

      at <anonymous> (/home/realme-book/Project/code/repograph/test/unit/render.test.ts:264:26)
âœ— Markdown Rendering > createMarkdownRenderer() > Renderer Customization Options > should not include code snippets when symbolDetailOptions.includeCodeSnippet is false
264 |         expect(markdown).toContain('**`function main`**');
265 |       });
266 |
267 |       it('should respect maxRelationsToShow option', () => {
268 |         const markdown = renderer(rankedGraph, { symbolDetailOptions: { maxRelationsToShow: 1 } });
269 |         expect(markdown).toContain('(calls `helper`...)');
                               ^
error: expect(received).toContain(expected)

Expected to contain: "(calls `helper`...)"
Received: "# RepoGraph\n\n_Generated by RepoGraph on 2025-06-30T05:24:21.802Z_\n\n## ðŸš€ Project Overview\n\nThis repository contains 6 nodes (2 files).\n\n### Module Dependency Graph\n\n```mermaid\ngraph TD\n    src/main.ts[\"main.ts\"] --> src/utils.ts[\"utils.ts\"]\n```\n### Top 10 Most Important Files\n\n| Rank | File | Description |\n| :--- | :--- | :--- |\n| 1 | `src/main.ts` | Key module in the architecture. |\n| 2 | `src/utils.ts` | Key module in the architecture. |\n\n---\n\n## ðŸ“‚ File & Symbol Breakdown\n\n### [`src/main.ts`](./src/main.ts)\n\n_No symbols identified in this file._\n\n---\n\n### [`src/utils.ts`](./src/utils.ts)\n\n_No symbols identified in this file._\n\n---\n\n"

      at <anonymous> (/home/realme-book/Project/code/repograph/test/unit/render.test.ts:269:26)
âœ— Markdown Rendering > createMarkdownRenderer() > Renderer Customization Options > should respect maxRelationsToShow option [1.00ms]

153 |
154 |       const markdown = renderer(rankedGraph);
155 |
156 |       expect(markdown).toContain('## ðŸ“‚ File & Symbol Breakdown');
157 |       expect(markdown).toContain('### [`src/test.ts`](./src/test.ts)');
158 |       expect(markdown).toContain('**`class TestClass`** - _L5_');
                             ^
error: expect(received).toContain(expected)

Expected to contain: "**`class TestClass`** - _L5_"
Received: "# RepoGraph\n\n_Generated by RepoGraph on 2025-06-30T05:24:21.809Z_\n\n## ðŸš€ Project Overview\n\nThis repository contains 3 nodes (1 files).\n\n### Module Dependency Graph\n\n```mermaid\ngraph TD\n\n```\n### Top 10 Most Important Files\n\n| Rank | File | Description |\n| :--- | :--- | :--- |\n| 1 | `src/test.ts` | Key module in the architecture. |\n\n---\n\n## ðŸ“‚ File & Symbol Breakdown\n\n### [`src/test.ts`](./src/test.ts)\n\n_No symbols identified in this file._\n\n---\n\n"

      at <anonymous> (/home/realme-book/Project/code/repograph/test/unit/render.test.ts:158:24)
âœ— Markdown Rendering > createMarkdownRenderer() > should include symbol details by default
âœ“ Markdown Rendering > createMarkdownRenderer() > should exclude symbol details when option is false
âœ“ Markdown Rendering > createMarkdownRenderer() > should include custom header when provided [1.00ms]
âœ“ Markdown Rendering > createMarkdownRenderer() > should handle files with no symbols
342 |       // Check that symbols appear in line number order
343 |       const firstFunctionIndex = markdown.indexOf('firstFunction');
344 |       const middleClassIndex = markdown.indexOf('middleClass');
345 |       const lastFunctionIndex = markdown.indexOf('lastFunction');
346 |
347 |       expect(firstFunctionIndex).toBeLessThan(middleClassIndex);
                                       ^
error: expect(received).toBeLessThan(expected)

Expected: < -1
Received: -1

      at <anonymous> (/home/realme-book/Project/code/repograph/test/unit/render.test.ts:347:34)
âœ— Markdown Rendering > createMarkdownRenderer() > should sort symbols by line number
âœ“ Markdown Rendering > createMarkdownRenderer() > should sort files by rank (highest first)
390 |         ])
391 |       };
392 |
393 |       const markdown = renderer(rankedGraph);
394 |
395 |       expect(markdown).toContain('**`function noSnippet`** - _L5_');
                             ^
error: expect(received).toContain(expected)

Expected to contain: "**`function noSnippet`** - _L5_"
Received: "# RepoGraph\n\n_Generated by RepoGraph on 2025-06-30T05:24:21.810Z_\n\n## ðŸš€ Project Overview\n\nThis repository contains 2 nodes (1 files).\n\n### Module Dependency Graph\n\n```mermaid\ngraph TD\n\n```\n### Top 10 Most Important Files\n\n| Rank | File | Description |\n| :--- | :--- | :--- |\n| 1 | `src/test.ts` | Key module in the architecture. |\n\n---\n\n## ðŸ“‚ File & Symbol Breakdown\n\n### [`src/test.ts`](./src/test.ts)\n\n_No symbols identified in this file._\n\n---\n\n"

      at <anonymous> (/home/realme-book/Project/code/repograph/test/unit/render.test.ts:395:24)
âœ— Markdown Rendering > createMarkdownRenderer() > should handle symbols without code snippets

579 |         ])
580 |       };
581 |
582 |       const markdown = renderer(rankedGraph);
583 |
584 |       expect(markdown).toContain('**`function empty`** - _L5_');
                             ^
error: expect(received).toContain(expected)

Expected to contain: "**`function empty`** - _L5_"
Received: "# RepoGraph\n\n_Generated by RepoGraph on 2025-06-30T05:24:21.839Z_\n\n## ðŸš€ Project Overview\n\nThis repository contains 2 nodes (1 files).\n\n### Module Dependency Graph\n\n```mermaid\ngraph TD\n\n```\n### Top 10 Most Important Files\n\n| Rank | File | Description |\n| :--- | :--- | :--- |\n| 1 | `src/test.ts` | Key module in the architecture. |\n\n---\n\n## ðŸ“‚ File & Symbol Breakdown\n\n### [`src/test.ts`](./src/test.ts)\n\n_No symbols identified in this file._\n\n---\n\n"

      at <anonymous> (/home/realme-book/Project/code/repograph/test/unit/render.test.ts:584:24)
âœ— Markdown Rendering > Edge Cases > should handle empty code snippets gracefully

test/unit/rank.test.ts:
fatal: not a git repository (or any parent up to mount point /)
Stopping at filesystem boundary (GIT_DISCOVERY_ACROSS_FILESYSTEM not set).
1 | export class RepoGraphError extends Error {
2 |   constructor(message: string, public readonly originalError?: unknown) {
3 |     super(message);
        ^
RepoGraphError: Failed to use 'git' for ranking. Is git installed and is this a git repository?
      at new RepoGraphError (/home/realme-book/Project/code/repograph/src/utils/error.util.ts:3:5)

error: Command failed: git log --max-count=500 --name-only --pretty=format:
fatal: not a git repository (or any parent up to mount point /)
Stopping at filesystem boundary (GIT_DISCOVERY_ACROSS_FILESYSTEM not set).

 signal: null,
 status: 128,
 output: [ null, "", "fatal: not a git repository (or any parent up to mount point /)\nStopping at filesystem boundary (GIT_DISCOVERY_ACROSS_FILESYSTEM not set).\n" ],
    pid: 23573,
 stdout: "",
 stderr: "fatal: not a git repository (or any parent up to mount point /)\nStopping at filesystem boundary (GIT_DISCOVERY_ACROSS_FILESYSTEM not set).\n",

      at genericNodeError (node:child_process:959:22)
âœ— Graph Ranking > createGitRanker() > should assign zero ranks when git is not available [5.00ms]
189 |       const graph: CodeGraph = createTestGraph([createTestNode('file1.ts'), createTestNode('file1.ts#symbol1', { type: 'function' })]);
190 |
191 |       const result = await gitRanker(graph);
192 |
193 |       // Symbol nodes should get rank 0 with git strategy
194 |       expect(result.ranks.get('symbol1')).toBe(0);
                                                ^
error: expect(received).toBe(expected)

Expected: 0
Received: undefined

      at <anonymous> (/home/realme-book/Project/code/repograph/test/unit/rank.test.ts:194:43)
âœ— Graph Ranking > createGitRanker() > should only rank file nodes with git strategy [13.00ms]


test/unit/composer.test.ts:

# Unhandled error between tests
-------------------------------
13 |   isValidMarkdown
       ^
error: Expected "}" but found "isValidMarkdown"
    at /home/realme-book/Project/code/repograph/test/unit/composer.test.ts:13:3

14 | } from '../test.util.js';
     ^
error: Expected "from" but found "}"
    at /home/realme-book/Project/code/repograph/test/unit/composer.test.ts:14:1
-------------------------------


12 tests failed:
âœ— Test Utilities > Validation Utilities > should validate markdown content [1.00ms]
âœ— Markdown Rendering > createMarkdownRenderer() > Renderer Customization Options > should not include relations when symbolDetailOptions.includeRelations is false
âœ— Markdown Rendering > createMarkdownRenderer() > Renderer Customization Options > should not include line numbers when symbolDetailOptions.includeLineNumber is false [1.00ms]
âœ— Markdown Rendering > createMarkdownRenderer() > Renderer Customization Options > should not include code snippets when symbolDetailOptions.includeCodeSnippet is false
âœ— Markdown Rendering > createMarkdownRenderer() > Renderer Customization Options > should respect maxRelationsToShow option [1.00ms]
âœ— Markdown Rendering > createMarkdownRenderer() > should include symbol details by default
âœ— Markdown Rendering > createMarkdownRenderer() > should sort symbols by line number
âœ— Markdown Rendering > createMarkdownRenderer() > should handle symbols without code snippets
âœ— Markdown Rendering > Edge Cases > should handle empty code snippets gracefully
âœ— Graph Ranking > createGitRanker() > should assign zero ranks when git is not available [5.00ms]
âœ— Graph Ranking > createGitRanker() > should only rank file nodes with git strategy [13.00ms]

 164 pass
 12 fail
 1 error
 440 expect() calls
Ran 176 tests across 10 files. [8.45s]


address the test problem because I made changes

here the report of changes;

The core of this effort was to abstract common patterns into powerful test utilities and convert repetitive tests into concise, data-driven formats.

Here is a summary of the changes:

*   **New Test Runner (`runRepoGraphForTests`):** I've introduced a powerful new test helper in `test.util.ts` that handles temporary project creation, execution of `generateMap`, and output file reading. This single function replaced a massive amount of boilerplate across multiple test files.
*   **Parameterized `multi-language.test.ts`:** This file saw the most dramatic reduction. The multiple, repetitive tests for each language have been collapsed into a single, data-driven `it.each` block, making the file over 80% smaller and trivial to extend with new languages.
*   **Consolidated Integration Tests:** I've merged the concerns of `test/integration/high-level.test.ts` into `test/integration/pipeline.test.ts` and then deleted the former. The integration tests now focus on the main `generateMap` entry point, eliminating an entire redundant file while maintaining test coverage.
*   **Parameterized CLI Tests:** In `test/e2e/cli.test.ts`, the numerous, nearly identical tests for output customization flags were converted into a single, parameterized `it.each` test, making the suite much more concise.
*   **Streamlined Unit Tests:** Verbose object creation in `render.test.ts` and `rank.test.ts` has been simplified using new helper functions, making the tests easier to read and write.
*   **Refocused `composer.test.ts`:** Redundant full-pipeline tests were removed, allowing the file to focus solely on its core responsibility: testing the composition of custom pipeline components.

The result is a much leaner, more maintainable, and "radically DRY" test suite, just as you requested. The logic is now more declarative, and adding new test cases is significantly easier.
